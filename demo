<!DOCTYPE html>  
<html lang="en">  
<head>  
<meta charset="utf-8"/>  
<title>Sensotik</title>  
<style>  
    *:focus { outline: none; }  
    .switch input:focus + .slider { box-shadow: none; }  
    body {-webkit-tap-highlight-color: transparent; }  
    :root {  
      --background: #000000;  
      --card-bg: #000000;  
      --primary: #ffffff;  
      --text: #ffffff;  
      --off-color: #ffffff;  
      --shadow: 0 10px 30px rgba(255,255,255,0.1);  
    }  
    * { box-sizing: border-box; margin: 0; padding: 0; }  
    body {  
      font-family: 'Segoe UI', sans-serif;  
      background: var(--background);  
      min-height: 100vh;  
      display: flex;  
      flex-direction: column;  
      align-items: center;  
      padding: 60px 20px;  
      transition: background-color 0.4s ease;  
    }  
    h1 { font-size: 84px; margin-bottom: 40px; color: var(--text); }  
    .container {  
      display: grid;  
      grid-template-columns: 1fr;  
      gap: 60px;  
      width: 100%;  
      max-width: 800px;  
    }  
    .card {  
      background: var(--card-bg);  
      border-radius: 30px;  
      padding: 80px;  
      box-shadow: var(--shadow);  
      display: flex;  
      flex-direction: column;  
      align-items: center;  
      justify-content: center;  
      border: 2px solid #ffffff;  
    }  
    .label {  
      font-size: 60px;  
      color: var(--text);  
      margin-bottom: 50px;  
      font-weight: bold;  
    }  
    .switch { position: relative; width: 220px; height: 110px; }  
    .switch input { opacity: 0; width: 0; height: 0; }  
    .slider {  
      position: absolute;  
      cursor: pointer;  
      top: 0; left: 0; right: 0; bottom: 0;  
      background-color: #ffffff;  
      transition: 0.4s;  
      border-radius: 55px;  
    }  
    .slider:before {  
      position: absolute;  
      content: "";  
      height: 94px; width: 94px;  
      left: 8px; top: 8px;  
      background-color: #000000;  
      transition: 0.4s;  
      border-radius: 50%;  
      box-shadow: 2px 2px 5px rgba(255,255,255,0.2);  
    }  
    input:checked + .slider { background-color: #ffffff; }  
    input:checked + .slider:before { 
      transform: translateX(110px); 
      background-color: #000000;
    }  
    .status {  
      margin-top: 50px;  
      font-size: 50px;  
      font-weight: 600;  
      color: #ffffff;  
      transition: color 0.3s ease;  
    }  
    input:checked ~ .status { color: #ffffff; }  
    @media (max-width: 768px) {  
      .container { grid-template-columns: 1fr; }  
    }  
    /* slideshow */  
    .slideshow-container {  
      width: 100%;  
      max-width: 900px;  
      height: 300px;  
      margin-bottom: 40px;  
      overflow: hidden;  
      border-radius: 20px;  
      box-shadow: 0 20px 40px rgba(255,255,255,0.3);  
      position: relative;  
      background-color: #000000;  
      border: 2px solid #ffffff;  
    }  
    .slide {  
      position: absolute;  
      width: 100%;  
      height: 100%;  
      top: 0;  
      left: 100%;  
      opacity: 0;  
      transition: all 1s ease;  
      object-fit: cover;  
      visibility: hidden;
    }  
    .slide.loaded {
      visibility: visible;
    }
    .slide.active { left: 0; opacity: 1; }  
    .slide.prev { left: -100%; opacity: 0; }  
    /* Skeletal loading */  
    .skeleton {  
      position: absolute;  
      top: 0; left: 0;  
      width: 100%;  
      height: 100%;  
      border-radius: 20px;  
      background: linear-gradient(90deg, #1a1a1a 25%, #2d2d2d 50%, #1a1a1a 75%);  
      background-size: 200% 100%;  
      animation: loading 1.5s infinite;  
      display: block;
    }  
    .skeleton.hidden {
      display: none;
    }
    @keyframes loading {  
      0% { background-position: 200% 0; }  
      100% { background-position: -200% 0; }  
    }  

    /* offline notices */  
    #user-offline-notice, #offline-notice {  
      position: fixed; 
      top: 0; 
      left: 0; 
      width: 100%;  
      padding: 15px 20px;
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      z-index: 10000; 
      display: none;
      transition: all 0.3s ease;
      color: #ffffff;
    }  
    #user-offline-notice { 
      background: #ff0000; 
      z-index: 10001; 
    }  
    #offline-notice { 
      background: #cc0000; 
    }  

    /* Icon next to Smart control */  
    .smart-icon {  
      font-size: 60px;  
      vertical-align: middle;  
      margin-left: 20px;  
      cursor: pointer;  
      transition: transform 0.3s ease;  
      color: #ffffff;
      text-decoration: none;
    }  
    .smart-icon:hover { transform: scale(1.2); }

</style>  
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>  
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>  
</head>  
<body>  
<div id="user-offline-notice">No internet connection</div>  
<div id="offline-notice">Device is offline</div>  

<h1 style="font-size: 55px; margin-top: 40px; margin-bottom: -70px; color: #ffffff; font-weight: 700; font-family: Arial, sans-serif;">  
  Sensotik  
</h1>  

<h1 style="font-size: 100px; margin-top: 100px; font-family: 'Verdana', sans-serif; font-weight: 700; color: #ffffff;">  
  Smart control  
  <a href="https://keen-strudel-3d9011.netlify.app/" class="smart-icon">‚è∞</a>  
</h1>  

<div class="slideshow-container" id="slideshow-main">  
  <div class="skeleton"></div>  
  <img class="slide active" src="https://res.cloudinary.com/djjhol6dg/image/upload/v1764503733/sbt6pkdaxququcmelsnp.jpg">  
  <img class="slide" src="https://res.cloudinary.com/djjhol6dg/image/upload/v1764505663/j5gjy4nnm5bvx3e9a9ad.png">  
  <img class="slide" src="https://res.cloudinary.com/djjhol6dg/image/upload/v1764505791/h7clbzskwzqtcxen9k3j.png">  
</div>  

<div class="container" style="flex-direction: column; display: flex; align-items: center;">  
  <div class="card" style="width: 100%; max-width: 700px;">  
    <div class="label">Light</div>  
    <label class="switch">  
      <input onchange="toggleDeviceFirebase('devices/light', this, 'statusLight')" type="checkbox"/>  
      <span class="slider"></span>  
    </label>  
    <div class="status" id="statusLight">OFF</div>  
  </div>  
  <div class="card" style="width: 100%; max-width: 700px; margin-top: 60px;">  
    <div class="label">Fan</div>  
    <label class="switch">  
      <input onchange="toggleDeviceFirebase('devices/fan', this, 'statusFan')" type="checkbox"/>  
      <span class="slider"></span>  
    </label>  
    <div class="status" id="statusFan">OFF</div>  
  </div>  
</div>  

<script>  
const firebaseConfig = {  
  apiKey: "AIzaSyBEjUf911-av1oV3dgr9IVXMNG8e25yLW0",  
  authDomain: "monir-smart-control.firebaseapp.com",  
  databaseURL: "https://monir-smart-control-default-rtdb.firebaseio.com",  
  projectId: "monir-smart-control",  
  storageBucket: "monir-smart-control.firebasestorage.app",  
  messagingSenderId: "435268128535",  
  appId: "1:435268128535:web:2a5f665c10295b704e7152",  
  measurementId: "G-496B19VT2C"  
};  
firebase.initializeApp(firebaseConfig);  
const db = firebase.database();  
  
// Improved slideshow with complete image loading
function initSlideshow(containerId) {
  const container = document.getElementById(containerId);
  const skeleton = container.querySelector('.skeleton');
  const images = container.querySelectorAll('img.slide');
  let loadedCount = 0;
  let currentIndex = 0;
  let slideshowStarted = false;

  // Preload all images
  images.forEach((img, index) => {
    const imgElement = new Image();
    imgElement.onload = function() {
      loadedCount++;
      images[index].classList.add('loaded');
      
      // All images loaded
      if (loadedCount === images.length) {
        skeleton.classList.add('hidden');
        
        // Start slideshow after all images are loaded
        if (!slideshowStarted) {
          slideshowStarted = true;
          setInterval(() => {
            images.forEach((slide, idx) => {
              slide.classList.remove('active', 'prev');
              if (idx === currentIndex) slide.classList.add('prev');
            });
            currentIndex = (currentIndex + 1) % images.length;
            images[currentIndex].classList.add('active');
          }, 5000);
        }
      }
    };
    imgElement.onerror = function() {
      loadedCount++;
      if (loadedCount === images.length) {
        skeleton.classList.add('hidden');
      }
    };
    imgElement.src = img.src;
  });
}

// Initialize slideshow
initSlideshow('slideshow-main');
  
// Toggle devices  
function toggleDeviceFirebase(refPath, element, statusId) {  
  const state = element.checked ? true : false;  
  firebase.database().ref(refPath).set(state);  
  document.getElementById(statusId).textContent = state ? "ON" : "OFF";  
}  
  
// Sync Light  
firebase.database().ref("devices/light").on("value", function(snapshot) {  
  const isOn = snapshot.val() === true;  
  const lightSwitch = document.querySelector('input[onchange*="devices/light"]');  
  const lightStatus = document.getElementById("statusLight");  
  lightSwitch.checked = isOn;  
  lightStatus.textContent = isOn ? "ON" : "OFF";  
  lightStatus.style.color = "#ffffff";  
});  
  
// Sync Fan  
firebase.database().ref("devices/fan").on("value", function(snapshot) {  
  const isOn = snapshot.val() === true;  
  const fanSwitch = document.querySelector('input[onchange*="devices/fan"]');  
  const fanStatus = document.getElementById("statusFan");  
  fanSwitch.checked = isOn;  
  fanStatus.textContent = isOn ? "ON" : "OFF";  
  fanStatus.style.color = "#ffffff";  
});  
  
// Device online/offline check (35 seconds interval)  
function checkLastSeenStatus() {  
  const lastSeenRef = firebase.database().ref("lastSeen");  
  const statusRef = firebase.database().ref("status");  
  lastSeenRef.once("value").then(snapshot => {  
    const lastSeenTime = snapshot.val();  
    const now = Date.now();  
    const diff = now - lastSeenTime;  
    const notice = document.getElementById("offline-notice");  
    const isOffline = diff > 35000; // 35 seconds  
  
    if (isOffline) {  
      statusRef.set("offline");  
      if (notice) notice.style.display = "block";  
    } else {  
      statusRef.set("online");  
      if (notice) notice.style.display = "none";  
    }  
  });  
}  
setInterval(checkLastSeenStatus, 35000);   
  
// User internet status  
window.addEventListener("offline", () => {  
  document.getElementById("user-offline-notice").style.display = "block";  
});  
window.addEventListener("online", () => {  
  document.getElementById("user-offline-notice").style.display = "none";  
});  
</script>  
</body>  
</html>
